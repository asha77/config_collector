#Использование YAUCC
##Установка и подготовка окружения
1. Если python не установлен, или стоит версия старше 3.7, нужно скачать Python поддерживаемых версий (3.7-3.9). 
Версия 3.9 качается по ссылке: https://www.python.org/ftp/python/3.9.0/python-3.9.0rc2-amd64.exe
3. Установить python 3.9, при установке поставить галку "Add python to path", остальные настройки "по умолчанию".
4. Скачать по ссылке: 
https://github.com/git-for-windows/git/releases/download/v2.39.1.windows.1/Git-2.39.1-64-bit.exe
и установить Git. При установке выбрать редактор в качестве дефолтного для Git из установденных в системе (например, notepad). Остальные настройки по умолчанию.
5. Создать папку, в которой будут запускаться скрипты, например, C:\scripts\.
6. В контекстном меню в папке (правая кнопка мыши в проводнике) выбрать "Git Bash Here". Запустится окно терминала git.
7. Наберите команду:
```
> git clone https://github.com/asha77/config_collector.git
```
Эта команда скачает скрипт в папку config_collector.
Перейдите в нее: 
```
> cd config_collector
```
Не закрывайте терминал.
7. Настроить окружение: в проводнике скопировать и переименовать файл ".env_init" в ".env". Файл ".env" будет использоваться только локально и не будет загружаться в репозиторий, т.к. не является его частью.
- открыть ".env" в notepad и изменить значения, чтобы файл выглядел так:
```
AUTH_USERNAME=<указать имя пользователя с которым можно авторизоваться на устройствах>
AUTH_PASSWORD=<указать пароль этого пользователя>
AUTH_SECONDARY=<пароль для enable, можно не указывать>
AUTH_STRICT_KEY=False
TRANSPORT=sshv2
TIMEOUT_SOCKET=5
TIMEOUT_TRANSPORT=10
WORKING_DIRECTORY=
```
Любые пробелы, табуляция после '=' или значений ключей должна отсутствовать.
8. Сформировать файл 'devices.txt' (см. пример файла 'devices_sample.txt' в репозитории и пояснения в README.md. 
9. Сформировать файл 'commands.txt' (см. пример файла 'cisco_commands.txt' в репозитории и пояснения в README.md. 

Команды п.11-14 выполняются последовательно в терминале git.
10. В консоли git в папке config_collector запустить команду создания виртуального окружения python. 
```
> python -m venv venv
```
11. Активировать виртуальное окружение python:
```
> source ./venv/scripts/activate
```
12. Обновить менеджер пакетов pip: 
```> python.exe -m pip install --upgrade pip```

13. Установить необходимые библиотеки: 
```> pip install -r requirements.txt```

14. Проверка версий установленного ПО:
```> python --version
> pip --version
> pip list
```

##Запуск скрипта
1. После успешного завершения процесса установки окружения, можно запустить YAUCC командой в терминале git:
```
>./start.sh
```
Скрипт сначала активирует venv, а затем запускает YAUCC c параметрами:
```
python -u -O main.py -d devices.txt -c commands.txt
```
2. В ходе работы скрипт пытается подключиться к каждому устройству и получить результат команды 'show ver', чтобы определить доступность устройства и его тип.
Затем скрипт по очереди выполняет на каждом устройстве команды из файла "commands.txt", при этом он выводит в консоль и лог-файл информационные сообщения.
3. Результаты работы скрипта сохраняются в папки:
```
\config_collector\output\cnf_<data и время>\
```
При каждом запуске создается новая папка. После завершения работы скрипта папки можно архивировать или удалять. 
4. После завершения работы скрипта (для большого количества команд опрос занимает до 40 секунд на устройство) python закончит выдаст сообщение о завершении работы.
После этого можно забрать результат его работы в последней по времени папке с результатами:
```
\config_collector\output\cnf_<data и время>\
```

##Действия при возникновении ошшибок 
1. Если в процессе работы наблюдались ошибки и конфигурации не были собраны, следует создать git issue и приложить следующие данные:
   - файл 'logfile.txt' из последней по времени папки c результатами работы программы.
   - вывод или скрипшот команд проверки версий ПО из консоли git:
    ```
    > python --version
    > pip --version
    > pip list
    ```
   - файл scrapli.log из папки config_collector.
Либо все вышепреречисленное прислать разработчикам (asha77@gmail.com).

##Обновление скрипта
Производится в консоли git командой:

```
> git pull
```

В результате git скачает изменения кода скрипта, но никаких изменений и настроек для обновленной версии производить не нужно (если это явно не указано).
